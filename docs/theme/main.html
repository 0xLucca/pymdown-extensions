{% extends "base.html" %}

{% block libs %}
<script type="text/javascript">
// Watch for body creation and add the last used scheme
"use strict";

(function () {

  var preferToggle = function(e) {
    if (localStorage.getItem("data-md-prefers-color-scheme") === "true") {
      document.querySelector("body").setAttribute("data-md-color-scheme", (e.matches) ? "dracula" : "default");
    }
  };

  var observer = new MutationObserver(function (mutations) {
    mutations.forEach(function (mutation) {
      if (mutation.type === "childList") {
        if (mutation.addedNodes.length) {
          for (var i = 0; i < mutation.addedNodes.length; i++) {
            var el = mutation.addedNodes[i];

            if (el.nodeType === 1 && el.tagName.toLowerCase() === "body") {
              var scheme = localStorage.getItem('data-md-color-scheme');
              var prefers = localStorage.getItem('data-md-prefers-color-scheme')
              var preferSupported = window.matchMedia('(prefers-color-scheme)').media !== 'not all';
              if (!scheme) {
                scheme = "default"
              }
              if (!prefers) {
                prefers == "false";
              }
              if (prefers === "true" && preferSupported) {
                var mm = window.matchMedia('(prefers-color-scheme: dark)');
                scheme = (mm.matches) ? 'dracula' : 'default';
                el.setAttribute("data-md-color-scheme", scheme);
                el.setAttribute("data-md-prefers-color-scheme", prefers);
              } else {
                el.setAttribute("data-md-color-scheme", scheme);
              }

              if (preferSupported) {
                var matchListener = window.matchMedia("(prefers-color-scheme: dark)");
                matchListener.addListener(preferToggle);
              }
            }
          }
        }
      }
    });
  });
  observer.observe(document.querySelector("html"), {
    childList: true
  });
})();

function toggleScheme() {
  var body = document.querySelector("body"),
      scheme = body.getAttribute("data-md-color-scheme"),
      prefer = body.getAttribute("data-md-prefers-color-scheme"),
      preferSupported = window.matchMedia('(prefers-color-scheme)').media !== 'not all';

  if (preferSupported && scheme === "default" && prefer !== "true") {
    prefer = "true"
    scheme = (window.matchMedia('(prefers-color-scheme: dark)').matches) ? "dracula" : "default"
  } else if ((preferSupported && prefer === "true") || scheme == "default") {
    prefer = "false"
    scheme = "dracula"
  } else if (scheme === "dracula") {
    prefer = "false"
    scheme = "default"
  }
  localStorage.setItem("data-md-prefers-color-scheme", prefer);
  body.setAttribute("data-md-prefers-color-scheme", prefer);
  body.setAttribute("data-md-color-scheme", scheme);
}
</script>
{% endblock %}

{% block announce %}{% include "announce.html" ignore missing %}{% endblock %}

{% block content %}
  {{ super() }}
  <footer class="sponsorship">
    <hr>
    <a href="https://github.com/sponsors/facelessuser" title="Become a sponsor">
      <span class="twemoji heart-throb-hover">
        {% set icon = "octicons/heart-fill-16" %}
        {% include ".icons/" ~ icon ~ ".svg" %}
      </span>
    </a>
    <hr>
  </footer>
{% endblock %}
